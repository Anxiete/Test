<%= render "header" %>
<div class="container-fluid p-5">
  <div class="grid">
    <% @cards.each do |card| %>
      <div class="card g-col-md-3 border border-3 border-dark p-3">
        <!-- Checks to see if theres an image on active storage if not, uses images link instead. -->
        <% if card.image.present? %>
          <img src="<%= url_for(card.image) %>" alt="<%= card.name%> " class="img-fluid">
        <% else %>
          <!-- Checks to see if the image link is valid. If not, uses a image of a card back of cardfight vanguard. -->
          <% 
          require 'net/http'
          require 'uri'
          img_url = card.img
          res = Net::HTTP.get_response(URI.parse(img_url))
          img_url = 'https://images.vanguardcard.io/images/assets/CardBack.jpg' unless res.code.to_i >= 200 && res.code.to_i < 400
        %>
          <img src="<%=img_url%>" alt="<%= card.name%> " class="img-fluid">
        <% end %>
        <div class="card-body">
          <h5 class="card-text text-center "><%= link_to card.name, card, :class => "text-decoration-none"%></h5>
          <p class="card-text text-center ">Price: <%= number_to_currency card.price%></p>
          <p class="card-text text-center "><%= card.effect%></p>

          <% if cart.include?(card) %>
            <%= button_to cart_path(card), method: :delete do%>
              Remove from cart
          <% end %>
          <% else %>
            <%= form_with url: cart_index_path, method: :post do%>
              <%= hidden_field_tag(:id, card.id)%>
              <%= button_tag 'Add to Cart' %>
            <% end %>
          <% end %>

        </div>
      </div>
    <% end %>
  </div>
  <div class="text-center mt-3 mb-3">
    <%= page_entries_info @cards %>
  </div>
  <div class="pagination justify-content-center">
    <%= paginate @cards, window: 2%>
  </div>
</div>
